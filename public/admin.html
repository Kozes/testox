<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>SK AX ìš´ì˜ì í˜ì´ì§€</title>
  <script src="/socket.io/socket.io.js"></script>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      background: linear-gradient(135deg, #2c3e50 0%, #34495e 25%, #2c2c54 50%, #40407a 75%, #706fd3 100%);
      background-size: 400% 400%;
      animation: gradientShift 20s ease infinite;
      min-height: 100vh;
      color: white;
      padding: 20px;
      margin: 0;
    }

    @keyframes gradientShift {
      0% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
      100% { background-position: 0% 50%; }
    }

    .admin-container {
      background: rgba(255, 255, 255, 0.08);
      backdrop-filter: blur(15px);
      max-width: 1000px;
      margin: auto;
      padding: 30px;
      border-radius: 20px;
      box-shadow: 0 8px 32px rgba(0,0,0,0.4);
      border: 1px solid rgba(255,255,255,0.1);
    }

    .admin-header {
      text-align: center;
      margin-bottom: 30px;
      padding-bottom: 20px;
      border-bottom: 1px solid rgba(255,255,255,0.1);
    }

    .admin-title {
      font-size: 2rem;
      font-weight: bold;
      margin-bottom: 10px;
      background: linear-gradient(45deg, #706fd3, #40407a);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .admin-subtitle {
      opacity: 0.8;
      font-size: 1.1rem;
    }

    .control-section {
      margin-bottom: 30px;
      padding: 20px;
      background: rgba(255,255,255,0.05);
      border-radius: 15px;
      border: 1px solid rgba(255,255,255,0.1);
    }

    .section-title {
      font-size: 1.3rem;
      font-weight: bold;
      margin-bottom: 15px;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .button-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 15px;
      margin-bottom: 20px;
    }

    button {
      padding: 12px 20px;
      font-size: 1rem;
      font-weight: bold;
      border: none;
      border-radius: 10px;
      cursor: pointer;
      transition: all 0.3s ease;
      background: linear-gradient(135deg, #706fd3, #40407a);
      color: white;
      box-shadow: 0 4px 15px rgba(112, 111, 211, 0.3);
    }

    button:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(112, 111, 211, 0.4);
    }

    .btn-primary { background: linear-gradient(135deg, #00d2ff, #3a7bd5); }
    .btn-success { background: linear-gradient(135deg, #4ecdc4, #44a08d); }
    .btn-warning { background: linear-gradient(135deg, #ffd700, #ffb347); color: #333; }
    .btn-danger { background: linear-gradient(135deg, #ff416c, #ff4b2b); }
    .btn-special { background: linear-gradient(135deg, #ffd700, #ffb347); color: #333; }

    .data-section {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 20px;
      margin-top: 20px;
    }

    .data-card {
      background: rgba(255,255,255,0.05);
      border-radius: 15px;
      padding: 20px;
      border: 1px solid rgba(255,255,255,0.1);
    }

    .data-card h3 {
      margin-bottom: 15px;
      color: #00d2ff;
    }

    #participant-list {
      list-style: none;
      padding: 0;
      max-height: 300px;
      overflow-y: auto;
    }

    #participant-list li {
      background: rgba(255,255,255,0.1);
      margin-bottom: 5px;
      padding: 8px 12px;
      border-radius: 8px;
      font-size: 0.9rem;
    }

    #log-box {
      max-height: 300px;
      overflow-y: auto;
      background: rgba(0,0,0,0.2);
      border-radius: 10px;
      padding: 15px;
    }

    .log-entry {
      border-bottom: 1px solid rgba(255,255,255,0.1);
      padding: 8px 0;
      font-size: 0.9rem;
      font-family: 'Courier New', monospace;
    }

    .log-entry:last-child {
      border-bottom: none;
    }

    #quiz-type-label {
      background: rgba(255,255,255,0.1);
      padding: 10px 15px;
      border-radius: 20px;
      margin: 15px 0;
      font-weight: bold;
      display: inline-block;
    }

    /* íŒ¨ìŠ¤ì›Œë“œ ëª¨ë‹¬ - ì •ë ¬ ê°œì„  */
    .password-modal {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0,0,0,0.8);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 9999;
      padding: 20px;
    }

    .password-content {
      background: linear-gradient(135deg, #706fd3, #40407a);
      padding: 40px 30px;
      border-radius: 20px;
      text-align: center;
      max-width: 450px;
      width: 100%;
      box-shadow: 0 20px 60px rgba(0,0,0,0.5);
      animation: modalSlideIn 0.5s ease-out;
      border: 1px solid rgba(255,255,255,0.1);
    }

    @keyframes modalSlideIn {
      from {
        opacity: 0;
        transform: translateY(-50px) scale(0.9);
      }
      to {
        opacity: 1;
        transform: translateY(0) scale(1);
      }
    }

    .password-content h2 {
      margin-bottom: 10px;
      color: white;
      font-size: 1.8rem;
      font-weight: bold;
    }

    .password-content p {
      margin-bottom: 25px;
      color: rgba(255,255,255,0.9);
      font-size: 1rem;
      line-height: 1.4;
    }

    .password-input {
      width: 100%;
      padding: 12px 20px;
      border: none;
      border-radius: 25px;
      font-size: 1rem;
      margin-bottom: 25px;
      text-align: center;
      outline: none;
      background: rgba(255,255,255,0.95);
      color: #333;
      box-shadow: inset 0 2px 10px rgba(0,0,0,0.1);
      transition: all 0.3s ease;
      max-width: 300px;
      margin-left: auto;
      margin-right: auto;
    }

    .password-input:focus {
      transform: scale(1.02);
      box-shadow: inset 0 2px 10px rgba(0,0,0,0.1), 0 0 20px rgba(255,255,255,0.3);
    }

    .password-input::placeholder {
      color: #666;
    }

    .password-buttons {
      display: flex;
      gap: 15px;
      justify-content: center;
      flex-wrap: wrap;
    }

    .password-btn {
      background: linear-gradient(135deg, #ffd700, #ffb347);
      color: #333;
      padding: 12px 20px;
      border: none;
      border-radius: 25px;
      font-weight: bold;
      cursor: pointer;
      font-size: 0.95rem;
      transition: all 0.3s ease;
      box-shadow: 0 4px 15px rgba(255, 215, 0, 0.3);
      min-width: 110px;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 6px;
    }

    .password-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(255, 215, 0, 0.4);
    }

    .password-btn.secondary {
      background: linear-gradient(135deg, #ff416c, #ff4b2b);
      color: white;
      box-shadow: 0 4px 15px rgba(255, 65, 108, 0.3);
    }

    .password-btn.secondary:hover {
      box-shadow: 0 6px 20px rgba(255, 65, 108, 0.4);
    }

    /* âœ… NEW: ì‹¤ì‹œê°„ íˆ¬í‘œ í˜„í™© */
    .vote-status-card {
      background: rgba(255,255,255,0.08);
      border-radius: 15px;
      padding: 20px;
      margin-bottom: 20px;
      border: 1px solid rgba(255,255,255,0.1);
    }

    .vote-progress {
      margin: 10px 0;
    }

    .vote-bar {
      display: flex;
      align-items: center;
      margin-bottom: 10px;
      gap: 10px;
    }

    .vote-option {
      width: 30px;
      height: 30px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
      color: white;
    }

    .o-option {
      background: linear-gradient(135deg, #00d2ff, #3a7bd5);
    }

    .x-option {
      background: linear-gradient(135deg, #ff416c, #ff4b2b);
    }

    .progress-bar {
      flex: 1;
      height: 10px;
      background: rgba(255,255,255,0.1);
      border-radius: 5px;
      overflow: hidden;
    }

    .progress-fill {
      height: 100%;
      transition: width 0.5s ease;
    }

    .o-fill { background: linear-gradient(90deg, #00d2ff, #3a7bd5); }
    .x-fill { background: linear-gradient(90deg, #ff416c, #ff4b2b); }

    .vote-count {
      min-width: 60px;
      text-align: right;
      font-weight: bold;
    }

    /* âœ… NEW: í•„í„° ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
    .filter-buttons {
      display: flex;
      gap: 8px;
      margin-bottom: 15px;
      flex-wrap: wrap;
    }

    .filter-btn {
      padding: 6px 12px;
      font-size: 0.8rem;
      border-radius: 15px;
      background: rgba(255,255,255,0.1);
      border: 1px solid rgba(255,255,255,0.2);
      color: white;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .filter-btn:hover, .filter-btn.active {
      background: linear-gradient(135deg, #706fd3, #40407a);
      border-color: #706fd3;
      transform: translateY(-1px);
    }

    .round-select {
      padding: 6px 10px;
      border-radius: 15px;
      background: rgba(255,255,255,0.1);
      border: 1px solid rgba(255,255,255,0.2);
      color: white;
      font-size: 0.8rem;
      cursor: pointer;
    }

    .round-select option {
      background: #2c3e50;
      color: white;
    }

    .participant-stats {
      margin-bottom: 10px;
      padding: 8px 12px;
      background: rgba(255,255,255,0.05);
      border-radius: 8px;
      font-size: 0.85rem;
      text-align: center;
      color: #00d2ff;
    }

    /* âœ… NEW: ì°¸ê°€ì ì•„ì´í…œ ê°œì„  */
    #participant-list li {
      background: rgba(255,255,255,0.1);
      margin-bottom: 8px;
      padding: 12px;
      border-radius: 8px;
      font-size: 0.9rem;
      border-left: 4px solid transparent;
      transition: all 0.3s ease;
    }

    #participant-list li:hover {
      background: rgba(255,255,255,0.15);
      transform: translateX(2px);
    }

    #participant-list li.survived {
      border-left-color: #ffd700;
      background: rgba(255, 215, 0, 0.1);
    }

    #participant-list li.eliminated {
      border-left-color: #ff6b6b;
      background: rgba(255, 107, 107, 0.1);
    }

    .participant-rounds {
      font-size: 0.75rem;
      opacity: 0.8;
      margin-top: 4px;
    }

    .round-badge {
      display: inline-block;
      padding: 2px 6px;
      margin: 1px;
      border-radius: 10px;
      font-size: 0.7rem;
      font-weight: bold;
    }

    .round-survived {
      background: rgba(76, 175, 80, 0.3);
      color: #4caf50;
    }

    .round-eliminated {
      background: rgba(244, 67, 54, 0.3);
      color: #f44336;
    }

    @media (max-width: 768px) {
      .data-section {
        grid-template-columns: 1fr;
      }
      .button-grid {
        grid-template-columns: 1fr;
      }
      
      .password-content {
        padding: 30px 20px;
        max-width: 350px;
      }
      
      .password-input {
        max-width: 280px;
        padding: 10px 15px;
        font-size: 0.9rem;
      }
      
      .password-content h2 {
        font-size: 1.5rem;
      }
      
      .password-buttons {
        flex-direction: column;
        gap: 10px;
      }
      
      .password-btn {
        min-width: 100%;
        font-size: 0.9rem;
        padding: 10px 16px;
      }
    }

    @keyframes shake {
      0%, 100% { transform: translateX(0); }
      25% { transform: translateX(-10px); }
      75% { transform: translateX(10px); }
    }
  </style>
</head>
<body>
  <!-- íŒ¨ìŠ¤ì›Œë“œ ëª¨ë‹¬ -->
  <div id="password-modal" class="password-modal">
    <div class="password-content">
      <h2>ğŸ”’ ê´€ë¦¬ì ì¸ì¦</h2>
      <p>SK AX OX í€´ì¦ˆ ê´€ë¦¬ì í˜ì´ì§€ì…ë‹ˆë‹¤<br>íŒ¨ìŠ¤ì›Œë“œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”</p>
      <input type="password" id="password-input" class="password-input" placeholder="íŒ¨ìŠ¤ì›Œë“œë¥¼ ì…ë ¥í•˜ì„¸ìš”" />
      <div class="password-buttons">
        <button onclick="checkPassword()" class="password-btn">
          <i class="fas fa-key"></i> ì¸ì¦
        </button>
        <button onclick="goToMain()" class="password-btn secondary">
          <i class="fas fa-home"></i> ë©”ì¸ìœ¼ë¡œ
        </button>
      </div>
    </div>
  </div>

  <div class="admin-container" id="admin-content" style="display: none;">
    <!-- í—¤ë” -->
    <div class="admin-header">
      <h1 class="admin-title">
        <i class="fas fa-cog"></i> SK AX OX í€´ì¦ˆ ê´€ë¦¬ì
      </h1>
      <p class="admin-subtitle">HC2 Group TownHall Meeting - ê´€ë¦¬ ì½˜ì†”</p>
    </div>

    <!-- ê²Œì„ ì œì–´ ì„¹ì…˜ -->
    <div class="control-section">
      <h3 class="section-title">
        <i class="fas fa-gamepad"></i> ê²Œì„ ì œì–´
      </h3>
      <div class="button-grid">
        <button onclick="startGame()" class="btn-primary">
          <i class="fas fa-play"></i> ê²Œì„ ì‹œì‘
        </button>
        <button onclick="nextQuestion()" class="btn-primary">
          <i class="fas fa-forward"></i> ë‹¤ìŒ ë¬¸ì œ
        </button>
        <button onclick="endRound()" class="btn-danger">
          <i class="fas fa-stop"></i> ë¼ìš´ë“œ ì¢…ë£Œ
        </button>
        <button onclick="resetGame()" class="btn-warning">
          <i class="fas fa-redo"></i> ê²Œì„ ì´ˆê¸°í™”
        </button>
      </div>
    </div>

    <!-- í€´ì¦ˆ íƒ€ì… ì„¤ì • -->
    <div class="control-section">
      <h3 class="section-title">
        <i class="fas fa-list"></i> í€´ì¦ˆ ì„¤ì •
      </h3>
      <div class="button-grid">
        <button onclick="setQuizType('general')" class="btn-success">
          <i class="fas fa-brain"></i> ìƒì‹ í€´ì¦ˆ
        </button>
        <button onclick="setQuizType('team')" class="btn-success">
          <i class="fas fa-users"></i> íŒ€ ê¸°ë°˜ í€´ì¦ˆ
        </button>
        <button onclick="sendCoreQuestion(1)" class="btn-special">
          <i class="fas fa-star"></i> í•µì‹¬í€´ì¦ˆ 1
        </button>
        <button onclick="sendCoreQuestion(2)" class="btn-special">
          <i class="fas fa-star"></i> í•µì‹¬í€´ì¦ˆ 2
        </button>
      </div>
      <div id="quiz-type-label">ì„ íƒëœ í€´ì¦ˆ íƒ€ì…: ì—†ìŒ</div>
    </div>

    <!-- âœ… NEW: ì‹¤ì‹œê°„ íˆ¬í‘œ í˜„í™© -->
    <div class="control-section">
      <h3 class="section-title">
        <i class="fas fa-chart-pie"></i> ì‹¤ì‹œê°„ íˆ¬í‘œ í˜„í™©
      </h3>
      <div id="vote-status-admin" class="vote-status-card" style="display: none;">
        <div class="vote-progress">
          <div class="vote-bar">
            <div class="vote-option o-option">O</div>
            <div class="progress-bar">
              <div id="admin-o-progress" class="progress-fill o-fill" style="width: 0%;"></div>
            </div>
            <div class="vote-count" id="admin-o-count">0ëª… (0%)</div>
          </div>
          <div class="vote-bar">
            <div class="vote-option x-option">X</div>
            <div class="progress-bar">
              <div id="admin-x-progress" class="progress-fill x-fill" style="width: 0%;"></div>
            </div>
            <div class="vote-count" id="admin-x-count">0ëª… (0%)</div>
          </div>
        </div>
        <div style="text-align: center; margin-top: 10px; opacity: 0.8;">
          <span id="admin-vote-summary">0ëª… / 0ëª… ì°¸ì—¬</span>
        </div>
      </div>
    </div>

    <!-- ìƒì¡´ì ê´€ë¦¬ -->
    <div class="control-section">
      <h3 class="section-title">
        <i class="fas fa-trophy"></i> ìƒì¡´ì ê´€ë¦¬
      </h3>
      <div class="button-grid">
        <button onclick="drawWinners(1)" class="btn-special">
          <i class="fas fa-dice"></i> ìƒì¡´ì 1ëª… ì¶”ì²¨
        </button>
        <button onclick="drawWinners(3)" class="btn-special">
          <i class="fas fa-dice"></i> ìƒì¡´ì 3ëª… ì¶”ì²¨
        </button>
      </div>
    </div>

    <!-- ë°ì´í„° ì„¹ì…˜ -->
    <div class="data-section">
      <div class="data-card">
        <h3><i class="fas fa-users"></i> ì°¸ê°€ì ë¦¬ìŠ¤íŠ¸</h3>
        
        <!-- âœ… NEW: í•„í„° ë²„íŠ¼ë“¤ -->
        <div class="filter-buttons">
          <button onclick="loadDetailedParticipants('all')" class="filter-btn active" id="filter-all">
            <i class="fas fa-list"></i> ì „ì²´
          </button>
          <button onclick="loadDetailedParticipants('survived')" class="filter-btn" id="filter-survived">
            <i class="fas fa-crown"></i> í˜„ì¬ ìƒì¡´ì
          </button>
          <button onclick="loadDetailedParticipants('eliminated')" class="filter-btn" id="filter-eliminated">
            <i class="fas fa-skull"></i> íƒˆë½ì
          </button>
          <select id="round-filter" onchange="filterByRound()" class="round-select">
            <option value="">ë¼ìš´ë“œë³„ ë³´ê¸°</option>
          </select>
        </div>
        
        <!-- âœ… NEW: ì°¸ê°€ì í†µê³„ -->
        <div class="participant-stats">
          <span id="stats-text">ì´ 0ëª… | ìƒì¡´ 0ëª… | íƒˆë½ 0ëª…</span>
        </div>
        
        <ul id="participant-list"></ul>
      </div>
      <div class="data-card">
        <h3><i class="fas fa-clipboard-list"></i> ì‹œìŠ¤í…œ ë¡œê·¸</h3>
        <div id="log-box"></div>
      </div>
    </div>
  </div>

  <script>
    const socket = io();
    const ADMIN_PASSWORD = "102030";

    // âœ… NEW: ê´€ë¦¬ììš© ì‹¤ì‹œê°„ íˆ¬í‘œ í˜„í™© ìˆ˜ì‹ 
    socket.on('adminVoteUpdate', (data) => {
      updateAdminVoteStatus(data);
    });

    // âœ… NEW: ê´€ë¦¬ì íˆ¬í‘œ í˜„í™© ì—…ë°ì´íŠ¸
    function updateAdminVoteStatus(data) {
      const statusDiv = document.getElementById('vote-status-admin');
      
      if (data.totalParticipants > 0) {
        statusDiv.style.display = 'block';
        
        // ì§„í–‰ë¥  ì—…ë°ì´íŠ¸
        document.getElementById('admin-o-progress').style.width = data.oPercentage + '%';
        document.getElementById('admin-x-progress').style.width = data.xPercentage + '%';
        
        // ì¹´ìš´íŠ¸ ì—…ë°ì´íŠ¸
        document.getElementById('admin-o-count').textContent = `${data.votes.O.count}ëª… (${data.oPercentage}%)`;
        document.getElementById('admin-x-count').textContent = `${data.votes.X.count}ëª… (${data.xPercentage}%)`;
        
        // ì „ì²´ í˜„í™©
        document.getElementById('admin-vote-summary').textContent = `${data.totalSubmitted}ëª… / ${data.totalParticipants}ëª… ì°¸ì—¬`;
      } else {
        statusDiv.style.display = 'none';
      }
    }

    // íŒ¨ìŠ¤ì›Œë“œ í™•ì¸
    function checkPassword() {
      const input = document.getElementById('password-input');
      const password = input.value.trim();
      
      if (password === ADMIN_PASSWORD) {
        document.getElementById('password-modal').style.display = 'none';
        document.getElementById('admin-content').style.display = 'block';
        showSuccessToast('ì¸ì¦ ì„±ê³µ! ê´€ë¦¬ì í˜ì´ì§€ì— ì˜¤ì‹  ê²ƒì„ í™˜ì˜í•©ë‹ˆë‹¤.');
        loadDetailedParticipants('all'); // âœ… ìƒì„¸ ì°¸ê°€ì ë¡œë“œë¡œ ë³€ê²½
        loadLogs();
        loadVoteStatus(); // âœ… íˆ¬í‘œ í˜„í™© ë¡œë“œ
      } else {
        input.style.animation = 'shake 0.5s ease-in-out';
        showErrorToast('ì˜ëª»ëœ íŒ¨ìŠ¤ì›Œë“œì…ë‹ˆë‹¤.');
        input.value = '';
        setTimeout(() => {
          input.style.animation = '';
        }, 500);
      }
    }

    function goToMain() {
      window.location.href = '/';
    }

    // ì—”í„°í‚¤ë¡œ íŒ¨ìŠ¤ì›Œë“œ ì…ë ¥
    document.addEventListener('DOMContentLoaded', () => {
      const passwordInput = document.getElementById('password-input');
      passwordInput.addEventListener('keypress', (e) => {
        if (e.key === 'Enter') {
          checkPassword();
        }
      });
      passwordInput.focus();
    });

    // í† ìŠ¤íŠ¸ ì•Œë¦¼ ì‹œìŠ¤í…œ
    function showSuccessToast(message) {
      showToast(message, 'success');
    }

    function showErrorToast(message) {
      showToast(message, 'error');
    }

    function showToast(message, type) {
      const toast = document.createElement('div');
      toast.style.cssText = `
        position: fixed;
        top: 20px;
        right: 20px;
        padding: 15px 20px;
        border-radius: 10px;
        color: white;
        font-weight: bold;
        z-index: 10000;
        transform: translateX(400px);
        transition: transform 0.3s ease;
        ${type === 'success' ? 'background: linear-gradient(135deg, #4ecdc4, #44a08d);' : 'background: linear-gradient(135deg, #ff416c, #ff4b2b);'}
      `;
      toast.textContent = message;
      document.body.appendChild(toast);
      
      setTimeout(() => {
        toast.style.transform = 'translateX(0)';
      }, 100);
      
      setTimeout(() => {
        toast.style.transform = 'translateX(400px)';
        setTimeout(() => {
          document.body.removeChild(toast);
        }, 300);
      }, 3000);
    }

    async function startGame() {
      const res = await fetch('/admin/start', { method: 'POST' });
      const data = await res.json();
      log(`ğŸ® ${data.message}`);
      updateQuizTypeLabel();
    }

    async function nextQuestion() {
      const res = await fetch('/admin/next', { method: 'POST' });
      const data = await res.json();
      log(`â­ ${data.message}`);
    }

    async function endRound() {
      console.log('ğŸ›‘ ë¼ìš´ë“œ ì¢…ë£Œ ìš”ì²­ ì‹œì‘...');
      const res = await fetch('/admin/end', { method: 'POST' });
      const data = await res.json();
      console.log('ğŸ“¡ ë¼ìš´ë“œ ì¢…ë£Œ ì‘ë‹µ:', data);
      
      log(`ğŸ›‘ ${data.message} - ìƒì¡´ì: ${data.survivors.join(', ')}`);
      
      // âœ… ì¦‰ì‹œ ì°¸ê°€ì ë¦¬ìŠ¤íŠ¸ ìƒˆë¡œê³ ì¹¨
      setTimeout(() => {
        loadDetailedParticipants('all');
      }, 500); // ì„œë²„ ì²˜ë¦¬ ì‹œê°„ ê³ ë ¤í•´ì„œ 0.5ì´ˆ í›„
    }

    async function setQuizType(type) {
      await fetch('/admin/set-type', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ type })
      });
      updateQuizTypeLabel(type);
      log(`ğŸ¯ í€´ì¦ˆ íƒ€ì… ì„¤ì •: ${type === 'team' ? 'íŒ€ ê¸°ë°˜' : 'ìƒì‹'} í€´ì¦ˆ`);
    }

    async function resetGame() {
      if (!confirm('âš ï¸ ì •ë§ ê²Œì„ì„ ì´ˆê¸°í™”í•˜ì‹œê² ìŠµë‹ˆê¹Œ?\nëª¨ë“  ë°ì´í„°ê°€ ì‚­ì œë©ë‹ˆë‹¤.')) return;
      
      const res = await fetch('/admin/reset', { method: 'POST' });
      const data = await res.json();
      log(`ğŸ”„ ${data.message}`);
      updateQuizTypeLabel();
      document.getElementById('participant-list').innerHTML = '';
      document.getElementById('vote-status-admin').style.display = 'none';
      // âœ… í•„í„° ì´ˆê¸°í™”
      setActiveFilter('all');
      document.getElementById('round-filter').innerHTML = '<option value="">ë¼ìš´ë“œë³„ ë³´ê¸°</option>';
      document.getElementById('stats-text').textContent = 'ì´ 0ëª… | ìƒì¡´ 0ëª… | íƒˆë½ 0ëª…';
    }

    async function sendCoreQuestion(version) {
      const res = await fetch('/admin/core-question', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ version })
      });
      const data = await res.json();
      log(`ğŸ’¡ ${data.message}`);
    }

    // âœ… ìƒì¡´ì ì¶”ì²¨ ê¸°ëŠ¥ (ìˆ˜ì •ë¨)
    async function drawWinners(count = 1) {
      try {
        const res = await fetch('/admin/draw-winners', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ count })
        });
        const data = await res.json();
        
        if (res.ok) {
          log(`ğŸ‰ ì¶”ì²¨ ì™„ë£Œ: ${data.winners.join(', ')} (ì´ ${data.totalSurvivors}ëª… ì¤‘)`);
          showSuccessToast(`ğŸ‰ ë‹¹ì²¨ì: ${data.winners.join(', ')}`);
        } else {
          log(`âš ï¸ ì¶”ì²¨ ì‹¤íŒ¨: ${data.message}`);
          showErrorToast(data.message);
        }
      } catch (error) {
        log('âŒ ì¶”ì²¨ ìš”ì²­ ì‹¤íŒ¨');
        showErrorToast('ì¶”ì²¨ ìš”ì²­ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
      }
    }

    // âœ… NEW: íˆ¬í‘œ í˜„í™© ë¡œë“œ
    async function loadVoteStatus() {
      try {
        const res = await fetch('/admin/vote-status');
        const data = await res.json();
        updateAdminVoteStatus(data);
      } catch (error) {
        console.error('íˆ¬í‘œ í˜„í™© ë¡œë“œ ì‹¤íŒ¨:', error);
      }
    }

    // âœ… NEW: ìƒì„¸ ì°¸ê°€ì ë¦¬ìŠ¤íŠ¸ ë¡œë“œ (í•„í„°ë§ ì§€ì›)
    async function loadDetailedParticipants(filter = 'all') {
      try {
        const res = await fetch(`/admin/participants-detailed?filter=${filter}`);
        const data = await res.json();
        
        renderDetailedParticipants(data.participants);
        updateParticipantStats(data);
        updateRoundFilter(data.availableRounds);
        setActiveFilter(filter);
        
      } catch (error) {
        log('âŒ ìƒì„¸ ì°¸ê°€ì ë¡œë“œ ì‹¤íŒ¨');
      }
    }

    // âœ… NEW: ìƒì„¸ ì°¸ê°€ì ë Œë”ë§
    function renderDetailedParticipants(participants) {
      const ul = document.getElementById('participant-list');
      ul.innerHTML = '';
      
      if (participants.length === 0) {
        ul.innerHTML = '<li style="text-align: center; opacity: 0.6;">ì°¸ê°€ìê°€ ì—†ìŠµë‹ˆë‹¤.</li>';
        return;
      }
      
      participants.forEach(p => {
        const li = document.createElement('li');
        li.className = p.status;
        
        // ë¼ìš´ë“œ ë±ƒì§€ ìƒì„±
        const roundBadges = p.survivedRounds.map(round => 
          `<span class="round-badge round-survived">${round}R</span>`
        ).join('');
        
        const eliminatedBadge = p.eliminatedAt ? 
          `<span class="round-badge round-eliminated">âŒ${p.eliminatedAt}R</span>` : '';
        
        const statusIcon = p.status === 'survived' ? 
          '<i class="fas fa-crown" style="color: #ffd700;"></i>' : 
          '<i class="fas fa-skull" style="color: #ff6b6b;"></i>';
        
        const statusText = p.status === 'survived' ? 
          `í˜„ì¬ ìƒì¡´ (${p.totalRounds}ë¼ìš´ë“œ ì°¸ì—¬)` : 
          `${p.eliminatedAt}ë¼ìš´ë“œ íƒˆë½ (ì´ ${p.totalRounds}ë¼ìš´ë“œ ì°¸ì—¬)`;
        
        li.innerHTML = `
          <div style="display: flex; align-items: center; justify-content: space-between;">
            <div>
              ${statusIcon} <strong>${p.name}</strong>
              <span style="margin-left: 10px; opacity: 0.8;">${statusText}</span>
            </div>
          </div>
          <div class="participant-rounds">
            ì°¸ì—¬ ë¼ìš´ë“œ: ${roundBadges} ${eliminatedBadge}
          </div>
        `;
        ul.appendChild(li);
      });
    }

    // âœ… NEW: ì°¸ê°€ì í†µê³„ ì—…ë°ì´íŠ¸
    function updateParticipantStats(data) {
      const statsText = `ì´ ${data.totalParticipants}ëª… | ìƒì¡´ ${data.currentSurvivors}ëª… | íƒˆë½ ${data.totalParticipants - data.currentSurvivors}ëª…`;
      document.getElementById('stats-text').textContent = statsText;
    }

    // âœ… NEW: ë¼ìš´ë“œ í•„í„° ì—…ë°ì´íŠ¸
    function updateRoundFilter(availableRounds) {
      const select = document.getElementById('round-filter');
      const currentValue = select.value;
      
      select.innerHTML = '<option value="">ë¼ìš´ë“œë³„ ë³´ê¸°</option>';
      availableRounds.forEach(round => {
        const option = document.createElement('option');
        option.value = `round-${round}`;
        option.textContent = `${round}ë¼ìš´ë“œ`;
        select.appendChild(option);
      });
      
      // ì´ì „ ì„ íƒê°’ ë³µì›
      if (currentValue && document.querySelector(`option[value="${currentValue}"]`)) {
        select.value = currentValue;
      }
    }

    // âœ… NEW: í™œì„± í•„í„° ì„¤ì •
    function setActiveFilter(filter) {
      document.querySelectorAll('.filter-btn').forEach(btn => btn.classList.remove('active'));
      const targetBtn = document.getElementById(`filter-${filter}`);
      if (targetBtn) {
        targetBtn.classList.add('active');
      }
    }

    // âœ… NEW: ë¼ìš´ë“œë³„ í•„í„°ë§
    function filterByRound() {
      const select = document.getElementById('round-filter');
      const selectedValue = select.value;
      
      if (selectedValue) {
        loadDetailedParticipants(selectedValue);
        // ë‹¤ë¥¸ í•„í„° ë²„íŠ¼ ë¹„í™œì„±í™”
        document.querySelectorAll('.filter-btn').forEach(btn => btn.classList.remove('active'));
      }
    }

    // âœ… ê¸°ì¡´ í•¨ìˆ˜ëŠ” í˜¸í™˜ì„±ì„ ìœ„í•´ ìœ ì§€
    async function loadParticipants() {
      try {
        const res = await fetch('/admin/participants');
        const data = await res.json();
        renderParticipants(data);
      } catch (error) {
        log('âŒ ì°¸ê°€ì ë¡œë“œ ì‹¤íŒ¨');
      }
    }

    async function loadLogs() {
      try {
        const res = await fetch('/admin/logs');
        const data = await res.json();
        const box = document.getElementById('log-box');
        box.innerHTML = '';
        data.forEach(msg => {
          const div = document.createElement('div');
          div.className = 'log-entry';
          div.innerText = msg;
          box.appendChild(div);
        });
        box.scrollTop = box.scrollHeight;
      } catch (error) {
        log('âŒ ë¡œê·¸ ë¡œë“œ ì‹¤íŒ¨');
      }
    }

    function renderParticipants(data) {
      const ul = document.getElementById('participant-list');
      ul.innerHTML = '';
      data.forEach(p => {
        const li = document.createElement('li');
        li.innerHTML = `
          <i class="fas fa-user"></i> ${p.name} 
          <span style="color: ${p.answer === 'O' ? '#4ecdc4' : '#ff416c'};">(${p.answer})</span> 
          ${p.survived ? '<span style="color: #ffd700;"><i class="fas fa-crown"></i> ìƒì¡´</span>' : '<span style="color: #999;"><i class="fas fa-skull"></i> íƒˆë½</span>'}
        `;
        ul.appendChild(li);
      });
    }

    function updateQuizTypeLabel(type = null) {
      const label = document.getElementById('quiz-type-label');
      if (type) {
        label.innerHTML = `<i class="fas fa-check-circle"></i> ì„ íƒëœ í€´ì¦ˆ íƒ€ì…: ${type === 'team' ? 'ğŸ‘¥ íŒ€ ê¸°ë°˜' : 'ğŸ§  ìƒì‹'} í€´ì¦ˆ`;
        label.style.background = 'linear-gradient(135deg, #4ecdc4, #44a08d)';
        label.style.color = 'white';
      } else {
        label.innerHTML = '<i class="fas fa-question-circle"></i> ì„ íƒëœ í€´ì¦ˆ íƒ€ì…: ì—†ìŒ';
        label.style.background = 'rgba(255,255,255,0.1)';
        label.style.color = 'white';
      }
    }

    function log(msg) {
      const box = document.getElementById('log-box');
      const div = document.createElement('div');
      div.className = 'log-entry';
      div.innerHTML = `<i class="fas fa-clock"></i> ${new Date().toLocaleTimeString()} - ${msg}`;
      box.appendChild(div);
      box.scrollTop = box.scrollHeight;
    }

    // ì†Œì¼“ ì´ë²¤íŠ¸
    socket.on('newParticipant', (data) => {
      console.log('ğŸ‘¤ ìƒˆ ì°¸ê°€ì ì´ë²¤íŠ¸ ìˆ˜ì‹ :', data);
      
      // âœ… ê¸°ì¡´ í•„í„° ìœ ì§€í•˜ë©´ì„œ ìƒˆë¡œê³ ì¹¨
      const activeFilter = document.querySelector('.filter-btn.active')?.id?.replace('filter-', '') || 'all';
      const roundFilter = document.getElementById('round-filter').value;
      
      if (roundFilter) {
        loadDetailedParticipants(roundFilter);
      } else {
        loadDetailedParticipants(activeFilter);
      }
      
      log(`ğŸ‘¤ ìƒˆ ì°¸ê°€ì ë“±ë¡ë¨ (ì´ ${data.length}ëª…)`);
    });

    // âœ… ë¼ìš´ë“œ ì¢…ë£Œ ì´ë²¤íŠ¸ ìˆ˜ì‹  ì‹œ ì°¸ê°€ì ë¦¬ìŠ¤íŠ¸ ìë™ ìƒˆë¡œê³ ì¹¨
    socket.on('roundEnded', (data) => {
      console.log('ğŸ¯ ì–´ë“œë¯¼ì—ì„œ ë¼ìš´ë“œ ì¢…ë£Œ ì´ë²¤íŠ¸ ìˆ˜ì‹ :', data);
      
      // í˜„ì¬ í•„í„° ìœ ì§€í•˜ë©´ì„œ ì°¸ê°€ì ë¦¬ìŠ¤íŠ¸ ìƒˆë¡œê³ ì¹¨
      setTimeout(() => {
        const activeFilter = document.querySelector('.filter-btn.active')?.id?.replace('filter-', '') || 'all';
        const roundFilter = document.getElementById('round-filter').value;
        
        if (roundFilter) {
          loadDetailedParticipants(roundFilter);
        } else {
          loadDetailedParticipants(activeFilter);
        }
        
        log(`ğŸ† ë¼ìš´ë“œ ì¢…ë£Œ ë°˜ì˜ ì™„ë£Œ - ìƒì¡´ì ${data.survivors?.length || 0}ëª…`);
      }, 300);
    });

    // âœ… ìƒˆ ë¬¸ì œ ì‹œ íˆ¬í‘œ í˜„í™© ìˆ¨ê¸°ê¸°
    socket.on('newQuestion', () => {
      document.getElementById('vote-status-admin').style.display = 'none';
    });

    // âœ… NEW: ê²Œì„ ì´ˆê¸°í™” ì‹œ ì–´ë“œë¯¼ í˜ì´ì§€ë„ ì´ˆê¸°í™”
    socket.on('reset', () => {
      // í˜ì´ì§€ ìƒíƒœ ì´ˆê¸°í™”
      document.getElementById('participant-list').innerHTML = '';
      document.getElementById('vote-status-admin').style.display = 'none';
      
      // í•„í„° ì´ˆê¸°í™”
      setActiveFilter('all');
      document.getElementById('round-filter').innerHTML = '<option value="">ë¼ìš´ë“œë³„ ë³´ê¸°</option>';
      document.getElementById('stats-text').textContent = 'ì´ 0ëª… | ìƒì¡´ 0ëª… | íƒˆë½ 0ëª…';
      
      // í€´ì¦ˆ íƒ€ì… ë¼ë²¨ ì´ˆê¸°í™”
      updateQuizTypeLabel();
      
      // í† ìŠ¤íŠ¸ ì•Œë¦¼
      showSuccessToast('ğŸ”„ ê²Œì„ì´ ì´ˆê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤!');
      
      log('ğŸ”„ ê´€ë¦¬ì í˜ì´ì§€ ì´ˆê¸°í™” ì™„ë£Œ');
    });
  </script>
</body>
</html>
